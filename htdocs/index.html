<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>哦,你也在这里吗</title>
<link href="css/twoColLiqLtHdr.css" rel="stylesheet" type="text/css" />

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="image/apple_shortcut.png"/>
  <link rel="shortcut icon" href="image/shortcut.ico"/>
<script src="CommonJs.js"></script>
</head>

<body>
<script>
 window.onload = function(){
		var httpreq = GetXmlHttpObject();
		if (httpreq) {
			httpreq.onreadystatechange=function()
			{
				if (httpreq.readyState==4 && httpreq.status==200)
				{
					var res = eval ("(" + httpreq.responseText + ")");
					var test = res.count;
					for (i = 0; i < res.count; i++) {
						if (0 != i) {
							document.getElementById("first_div").innerHTML += "<br/><br/>";
						}
						document.getElementById("first_div").innerHTML += "<div class=\"fltlft\">" + res.posts[i].topic + "</div>"
						document.getElementById("first_div").innerHTML += "<div align=\"right\">" + res.posts[i].time + "</div>"
						document.getElementById("first_div").innerHTML += "<div>" + res.posts[i].body + "</div>";
					}
				}
			}
			var url =  "load_posts.php";
			httpreq.open("POST", url, true);
			httpreq.setRequestHeader("Content-type","application/x-www-form-urlencoded");
			httpreq.send("q=0&qq=");
		}
 }
 
 var ac = new (window.AudioContext || window.webkitAudioContext)();
 var active_src = null;
 
 function audio_reset()
 {
	if (active_src) {
		active_src[active_src.stop ? "stop" : "noteOff"](0);
		active_src = null;
	}
	document.getElementById("play_href").innerHTML = "听雨";
	return;
 }
 function play()
 {
	if (active_src) {
		audio_reset();
		return;
	}
		var httpreq = GetXmlHttpObject();
		if (httpreq) {
			httpreq.onload = function() {
				ac.decodeAudioData(httpreq.response, function(buffer){
					var bufferSource = ac.createBufferSource();
					bufferSource.buffer = buffer;
					bufferSource.connect(ac.destination);
					bufferSource[bufferSource.start ? "start" : "noteOn"](0);
					bufferSource.loop = true;
					active_src = bufferSource;
					document.getElementById("play_href").innerHTML = " 郑长老，收了神通吧！";				
				}, function(err){
					audio_reset();
				});
			}
			var url =  "music/RainyMood_20152821646.mp3";
			httpreq.open("GET", url, true);
			httpreq.responseType = "arraybuffer";
			httpreq.send();
			document.getElementById("play_href").innerHTML = "  祈雨中...";
		}
 }

</script>
<div class="container">
  <div class="sidebar1">
      <!div style="width:20%; position:fixed; top:3%; left:5%;"><!img src="image/face.jpg" width="194" height="195" alt="face" />
      <div style="width:15%; position:fixed; top:3%; left:5%;"><img src="image/face.jpg" width=100% height=100% alt="face" /></div>
    <ul class="nav">
      <li><a href="#">主页</a></li>
      <li><a href="/mud.html">大型文字MUD</a></li>
      <li><a href="https://github.com/dooqaqa" target="new">GitHub</a></li>
      <li><a href="/about">档案</a></li>
      <li><a id="play_href" href="javascript:void(play())">听雨</a></li>
    </ul>
  <!-- end .sidebar1 --></div>
  
  <div id="first_div" style="width:60%; position:fixed; left:30%;">

  </div>
</div>
  
  <div style="width:75%; position:fixed; left:25%; top:85%;_position:absolute; _margin-top: 0; _top:expression(documentElement.scrollTop+(documentElement.clientHeight-this.offsetHeight)/2+50);">
      <!embed src="music/RainyMood_20152821646.mp3" width=100% height=15% palette="red|black" autostart="false" loop="true"/>
  </div>
  <!-- end .content --></div>
</body>
</html>
